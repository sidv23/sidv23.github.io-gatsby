"use strict";

var _ = require("lodash");

var replacePath = function replacePath(_path) {
  return _path === "/" ? _path : _path.replace(/\/$|$/, "/");
};

exports.onCreatePage = function (_ref, pluginOptions) {
  var page = _ref.page,
      actions = _ref.actions;
  var createPage = actions.createPage,
      deletePage = actions.deletePage;
  var options = {
    excludedPaths: ["/404.html"]
  };

  var combinedOptions = _.defaults(pluginOptions, options);

  return new Promise(function (resolve) {
    if (!combinedOptions.excludedPaths.includes(page.path)) {
      var oldPage = Object.assign({}, page);
      page.path = replacePath(page.path);

      if (page.path !== oldPage.path) {
        deletePage(oldPage);
        createPage(page);
      }
    }

    resolve();
  });
};